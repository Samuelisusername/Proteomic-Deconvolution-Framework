load("myinput2.gbm.rdata")
suppressWarnings(library(BayesPrism))
sc.dat.filtered <- cleanup.genes (input=sc.dat, input.type="count.matrix", species="hs", gene.group=c( "Rb","Mrp","other_Rb","chrM","MALAT1","chrX","chrY") , exp.cells=5)
myPrism <-new.prism(
  reference=sc.dat.filtered,
  mixture=bk.dat,
  input.type="GEP",
  cell.type.labels = cell.type.labels,
  cell.state.labels = cell.state.labels,
  key=NULL,
  outlier.cut=0.01,
    outlier.fraction=0.1,
)
bp.res <- run.prism(prism = myPrism, n.cores=5)
colnames(theta) <- c(
  #"Mixture",
  "LFQ.intensity.imputed_B.memory_04_steady-state",
  "LFQ.intensity.imputed_B.naive_04_steady-state",
  "LFQ.intensity.imputed_B.plasma_04_steady-state",
  "LFQ.intensity.imputed_mTregs_04_steady-state",
  "LFQ.intensity.imputed_T4.naive_04_steady-state",
  "LFQ.intensity.imputed_nTregs_04_steady-state",
  "LFQ.intensity.imputed_T4.CM_04_steady-state",
  "LFQ.intensity.imputed_T4.EM_04_steady-state",
  "LFQ.intensity.imputed_T4.EMRA_04_steady-state",
  "LFQ.intensity.imputed_Th1_04_steady-state",
  "LFQ.intensity.imputed_Th17_04_steady-state",
  "LFQ.intensity.imputed_Th2_04_steady-state",
  "LFQ.intensity.imputed_T8.naive_04_steady-state",
  "LFQ.intensity.imputed_T8.CM_04_steady-state",
  "LFQ.intensity.imputed_T8.EM_04_steady-state",
  "LFQ.intensity.imputed_T8.EMRA_04_steady-state",
  "LFQ.intensity.imputed_mDC_04_steady-state",
  "LFQ.intensity.imputed_pDC_04_steady-state",
  "LFQ.intensity.imputed_Basophil_04_steady-state",
  "LFQ.intensity.imputed_Eosinophil_04_steady-state",
  "LFQ.intensity.imputed_Neutrophil_04_steady-state",
  "LFQ.intensity.imputed_MO.classical_04_steady-state",
  "LFQ.intensity.imputed_MO.intermediate_04_steady-state",
  "LFQ.intensity.imputed_MO.nonclassical_04_steady-state",
  "LFQ.intensity.imputed_NK.bright_04_steady-state",
  "LFQ.intensity.imputed_NK.dim_04_steady-state"
)
theta <- get.fraction (bp=bp.res,
            which.theta="final",
            state.or.type="type")
colnames(theta) <- c(
  #"Mixture",
  "LFQ.intensity.imputed_B.memory_04_steady-state",
  "LFQ.intensity.imputed_B.naive_04_steady-state",
  "LFQ.intensity.imputed_B.plasma_04_steady-state",
  "LFQ.intensity.imputed_mTregs_04_steady-state",
  "LFQ.intensity.imputed_T4.naive_04_steady-state",
  "LFQ.intensity.imputed_nTregs_04_steady-state",
  "LFQ.intensity.imputed_T4.CM_04_steady-state",
  "LFQ.intensity.imputed_T4.EM_04_steady-state",
  "LFQ.intensity.imputed_T4.EMRA_04_steady-state",
  "LFQ.intensity.imputed_Th1_04_steady-state",
  "LFQ.intensity.imputed_Th17_04_steady-state",
  "LFQ.intensity.imputed_Th2_04_steady-state",
  "LFQ.intensity.imputed_T8.naive_04_steady-state",
  "LFQ.intensity.imputed_T8.CM_04_steady-state",
  "LFQ.intensity.imputed_T8.EM_04_steady-state",
  "LFQ.intensity.imputed_T8.EMRA_04_steady-state",
  "LFQ.intensity.imputed_mDC_04_steady-state",
  "LFQ.intensity.imputed_pDC_04_steady-state",
  "LFQ.intensity.imputed_Basophil_04_steady-state",
  "LFQ.intensity.imputed_Eosinophil_04_steady-state",
  "LFQ.intensity.imputed_Neutrophil_04_steady-state",
  "LFQ.intensity.imputed_MO.classical_04_steady-state",
  "LFQ.intensity.imputed_MO.intermediate_04_steady-state",
  "LFQ.intensity.imputed_MO.nonclassical_04_steady-state",
  "LFQ.intensity.imputed_NK.bright_04_steady-state",
  "LFQ.intensity.imputed_NK.dim_04_steady-state"
)
write.table(theta, file = "BAYESPRISM-Results.txt", sep ="\t", row.names = TRUE, col.names = TRUE, quote = FALSE)
save.image(file = "myinput2.gbm.rdata")
q()
load("myinput_gen.gbm.rdata")
ls
ls()
names(bp.res)
bp.theta
ls
ls()
updated_sig <- myPrism@theta
str(theta)
names(bp.res)
str(bp.res, max.level = 2)
updated_sig <- bp.res@reference.update@phi
dim(updated_sig)
rownames(updated_sig)  # genes
colnames(updated_sig)  # cell types
q()
